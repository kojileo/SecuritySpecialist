# WPA2入門 - 無線LANセキュリティの基本を理解する

## 目次
1. [WPA2とは何か](#wpa2とは何か)
2. [WPA2の基本概念と仕組み](#wpa2の基本概念と仕組み)
3. [WPA2の認証方式](#wpa2の認証方式)
4. [WPA2の暗号化技術](#wpa2の暗号化技術)
5. [WPA2の設定と実装](#wpa2の設定と実装)
6. [WPA2のセキュリティと脅威](#wpa2のセキュリティと脅威)
7. [WPA2のトラブルシューティング](#wpa2のトラブルシューティング)
8. [まとめ](#まとめ)

---

## WPA2とは何か

### 基本定義
**WPA2（Wi-Fi Protected Access 2）**は、無線LAN（Wi-Fi）のセキュリティ規格です。IEEE 802.11i標準に基づいて策定され、無線通信の暗号化と認証を提供することで、Wi-Fiネットワークのセキュリティを大幅に向上させました。

### WPA2の役割
- **データの暗号化**: 無線通信の内容を暗号化して保護
- **認証機能**: 正当なユーザーのみがネットワークにアクセス可能
- **整合性保護**: データの改ざんを検出・防止
- **プライバシー保護**: 通信内容の盗聴を防止

### なぜWPA2が必要なのか

#### 無線LANの脆弱性
- **電波の特性**: 誰でも受信可能な電波での通信
- **盗聴の容易さ**: 物理的な接続が不要
- **改ざんの可能性**: 電波の傍受と改ざん
- **なりすまし攻撃**: 偽のアクセスポイントの設置

#### WPA2の効果
- **強力な暗号化**: AES暗号による高セキュリティ
- **認証の強化**: 802.1X認証による厳格な認証
- **改ざん検出**: MIC（Message Integrity Check）による検出
- **セキュリティの標準化**: 業界標準による統一されたセキュリティ

---

## WPA2の基本概念と仕組み

### WPA2の基本構成

#### 主要コンポーネント
```
WPA2の構成要素:
- アクセスポイント（AP）: 無線LANの基地局
- クライアント: 接続するデバイス
- 認証サーバー: ユーザー認証を行うサーバー
- 暗号化キー: 通信を暗号化するためのキー
```

#### 通信の流れ
```
1. クライアントがアクセスポイントを発見
2. 認証プロセスの実行
3. 暗号化キーの交換
4. 暗号化された通信の開始
5. 定期的なキーの更新
```

### WPA2の動作原理

#### 基本的な動作フロー
```
1. ネットワーク発見
   クライアント → アクセスポイント: プローブ要求
   アクセスポイント → クライアント: プローブ応答

2. 認証
   クライアント → アクセスポイント: 認証要求
   アクセスポイント → クライアント: 認証応答

3. 関連付け
   クライアント → アクセスポイント: 関連付け要求
   アクセスポイント → クライアント: 関連付け応答

4. 4ウェイハンドシェイク
   暗号化キーの交換と確認

5. データ通信
   暗号化されたデータの送受信
```

#### 4ウェイハンドシェイク
```
4ウェイハンドシェイクの流れ:

1. アクセスポイント → クライアント: ANonce（乱数）
2. クライアント → アクセスポイント: SNonce（乱数）+ MIC
3. アクセスポイント → クライアント: GTK（グループ一時キー）+ MIC
4. クライアント → アクセスポイント: 確認メッセージ

目的:
- PTK（Pairwise Transient Key）の生成
- GTK（Group Temporal Key）の配布
- 相互認証の実行
```

---

## WPA2の認証方式

### 1. WPA2-Personal（PSK）

#### 基本概念
```
WPA2-Personal:
- 事前共有キー（PSK）を使用
- 家庭や小規模オフィス向け
- 設定が簡単
- パスワードベースの認証
```

#### 認証の流れ
```
1. クライアントがパスワードを入力
2. パスワードからPMK（Pairwise Master Key）を生成
3. 4ウェイハンドシェイクでPTKを生成
4. 暗号化通信の開始
```

#### 設定例
```
アクセスポイントの設定:
- セキュリティモード: WPA2-Personal
- 暗号化: AES
- パスワード: 強力なパスワード（8文字以上）

クライアントの設定:
- ネットワーク名（SSID）の選択
- パスワードの入力
- 自動接続の設定
```

### 2. WPA2-Enterprise（802.1X）

#### 基本概念
```
WPA2-Enterprise:
- 802.1X認証を使用
- 企業や大規模組織向け
- 中央集権的な認証
- ユーザー単位での認証
```

#### 認証の流れ
```
1. クライアントがアクセスポイントに接続
2. アクセスポイントが認証サーバーに認証要求
3. 認証サーバーがクライアントを認証
4. 認証成功時に暗号化キーを配布
5. 暗号化通信の開始
```

#### 認証サーバーの種類
```
RADIUSサーバー:
- ユーザー認証
- 認証情報の管理
- アクセス制御

例:
- FreeRADIUS（オープンソース）
- Microsoft NPS（Network Policy Server）
- Cisco ISE（Identity Services Engine）
```

### 3. 認証方式の比較

#### WPA2-Personal vs WPA2-Enterprise
```
| 項目 | WPA2-Personal | WPA2-Enterprise |
|------|---------------|-----------------|
| **認証方式** | パスワード | 802.1X |
| **管理** | 手動 | 中央集権 |
| **スケーラビリティ** | 小規模 | 大規模 |
| **セキュリティ** | 中程度 | 高い |
| **設定の複雑さ** | 簡単 | 複雑 |
| **コスト** | 低い | 高い |
```

---

## WPA2の暗号化技術

### 1. AES暗号化

#### 基本概念
```
AES（Advanced Encryption Standard）:
- 対称暗号化アルゴリズム
- 128ビット、192ビット、256ビットのキー長
- WPA2では128ビットを使用
- 高速で安全な暗号化
```

#### AESの特徴
```
特徴:
- ブロック暗号（16バイト単位）
- 高速な暗号化・復号化
- ハードウェアサポート
- 広く使用されている標準

セキュリティ:
- 強力な暗号化強度
- 既知の攻撃に対する耐性
- 政府機関でも使用される信頼性
```

### 2. CCMP（Counter Mode with CBC-MAC Protocol）

#### 基本概念
```
CCMP:
- WPA2で使用される暗号化プロトコル
- AES暗号化を使用
- 認証と暗号化を同時に提供
- データの整合性も保護
```

#### CCMPの動作
```
動作:
1. データを16バイトのブロックに分割
2. 各ブロックをAESで暗号化
3. 認証コード（MIC）を生成
4. 暗号化データとMICを送信

利点:
- 強力な暗号化
- 改ざん検出
- リプレイ攻撃の防止
```

### 3. キー管理

#### キーの種類
```
PMK（Pairwise Master Key）:
- 認証から生成されるマスターキー
- セッション中は変更されない
- パスワードまたは認証サーバーから生成

PTK（Pairwise Transient Key）:
- 実際の暗号化に使用されるキー
- 4ウェイハンドシェイクで生成
- 定期的に更新される

GTK（Group Temporal Key）:
- マルチキャスト通信用のキー
- すべてのクライアントで共有
- 定期的に更新される
```

#### キーの更新
```
更新タイミング:
- 定期的な更新（通常1時間）
- クライアントの切断・再接続時
- セキュリティポリシーに基づく更新

更新プロセス:
1. 新しいキーの生成
2. 4ウェイハンドシェイクの実行
3. 古いキーの無効化
4. 新しいキーでの通信開始
```

---

## WPA2の設定と実装

### 1. アクセスポイントの設定

#### 基本的な設定項目
```
必須設定:
- SSID（ネットワーク名）
- セキュリティモード（WPA2-Personal/Enterprise）
- 暗号化方式（AES）
- パスワード（WPA2-Personalの場合）

推奨設定:
- 隠しSSIDの無効化
- MACアドレスフィルタリングの無効化
- WPSの無効化
- 管理画面のセキュリティ強化
```

#### 設定例（WPA2-Personal）
```
アクセスポイント設定:
- SSID: MySecureNetwork
- セキュリティ: WPA2-Personal
- 暗号化: AES
- パスワード: MySecurePassword123!
- チャンネル: 自動選択
- 出力電力: 最大
```

#### 設定例（WPA2-Enterprise）
```
アクセスポイント設定:
- SSID: CorporateNetwork
- セキュリティ: WPA2-Enterprise
- 暗号化: AES
- 認証サーバー: 192.168.1.100
- ポート: 1812
- 共有シークレット: MySecretKey

認証サーバー設定:
- サーバー: FreeRADIUS
- データベース: MySQL
- ユーザー管理: LDAP連携
```

### 2. クライアントの設定

#### Windowsでの設定
```
設定手順:
1. ネットワーク設定を開く
2. Wi-Fi設定を選択
3. 利用可能なネットワークを表示
4. 対象ネットワークを選択
5. セキュリティキーを入力
6. 接続を確認
```

#### 設定例
```
接続設定:
- ネットワーク名: MySecureNetwork
- セキュリティ: WPA2-Personal
- 暗号化: AES
- セキュリティキー: MySecurePassword123!
- 自動接続: 有効
```

### 3. 企業環境での実装

#### ネットワーク設計
```
設計例:
- アクセスポイント: 複数台配置
- 認証サーバー: 冗長化
- ネットワーク分離: VLAN使用
- 監視システム: 導入

セキュリティポリシー:
- パスワードポリシー
- アクセス制御ポリシー
- 監査ポリシー
- インシデント対応ポリシー
```

#### 運用管理
```
日常管理:
- アクセスポイントの監視
- 認証ログの確認
- セキュリティ更新の適用
- パフォーマンス監視

定期メンテナンス:
- 設定の見直し
- セキュリティテスト
- バックアップの取得
- ドキュメントの更新
```

---

## WPA2のセキュリティと脅威

### 1. WPA2の主要な脅威

#### KRACK攻撃（Key Reinstallation Attack）
```
攻撃手法:
- 4ウェイハンドシェイクの脆弱性を悪用
- 暗号化キーの再インストールを強制
- 暗号化通信の解読

影響:
- データの盗聴
- データの改ざん
- なりすまし攻撃

対策:
- ファームウェアの更新
- WPA3への移行
- 追加のセキュリティ対策
```

#### ブルートフォース攻撃
```
攻撃手法:
- パスワードの総当たり攻撃
- 辞書攻撃
- レインボーテーブル攻撃

影響:
- パスワードの解読
- 不正アクセス
- ネットワークの乗っ取り

対策:
- 強力なパスワードの使用
- レート制限の実装
- アカウントロックアウト
```

#### エビルツイン攻撃
```
攻撃手法:
- 偽のアクセスポイントの設置
- 正規のアクセスポイントを模倣
- ユーザーを偽のネットワークに誘導

影響:
- 認証情報の盗取
- データの盗聴
- マルウェアの感染

対策:
- 証明書ベースの認証
- ネットワーク名の確認
- セキュリティソフトの使用
```

### 2. セキュリティ対策

#### 基本的な対策
```
パスワードポリシー:
- 8文字以上の長さ
- 大文字・小文字・数字・記号の組み合わせ
- 定期的な変更
- 辞書に載らない単語の使用

ネットワーク設定:
- 隠しSSIDの無効化
- MACアドレスフィルタリングの無効化
- WPSの無効化
- 管理画面のセキュリティ強化
```

#### 高度な対策
```
WPA2-Enterprise:
- 802.1X認証の使用
- 中央集権的な認証
- ユーザー単位でのアクセス制御
- 監査ログの取得

追加セキュリティ:
- VPNの使用
- ネットワーク分離
- 侵入検知システム
- セキュリティ監視
```

### 3. セキュリティベストプラクティス

#### 設計段階での考慮事項
```
セキュリティ設計:
- 多層防御の実装
- 最小権限の原則
- セキュリティバイデザイン
- 定期的なセキュリティ評価

技術的対策:
- 強力な暗号化の使用
- 認証の強化
- 監視とログの実装
- インシデント対応の準備
```

#### 運用段階での考慮事項
```
日常運用:
- セキュリティ更新の適用
- ログの監視と分析
- 異常検知と対応
- 定期的なセキュリティテスト

教育と訓練:
- セキュリティ意識の向上
- インシデント対応訓練
- ベストプラクティスの共有
- 定期的な研修の実施
```

---

## WPA2のトラブルシューティング

### 1. 一般的な問題と解決方法

#### 接続できない問題

##### 症状
- Wi-Fiネットワークに接続できない
- 接続はできるがインターネットにアクセスできない
- 接続が不安定で頻繁に切断される

##### 診断手順
```bash
# Windowsでの診断
netsh wlan show profiles
netsh wlan show profile name="ネットワーク名" key=clear
netsh wlan show interfaces
netsh wlan show networks

# Linuxでの診断
iwconfig
iwlist scan
wpa_supplicant -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
```

##### 解決方法
```
1. 設定の確認
   - SSIDの確認
   - パスワードの確認
   - セキュリティ設定の確認

2. デバイスの確認
   - Wi-Fiアダプターの状態
   - ドライバーの更新
   - ハードウェアの確認

3. ネットワークの確認
   - アクセスポイントの状態
   - 信号強度の確認
   - チャンネルの確認
```

#### 認証エラー

##### 症状
- 認証に失敗する
- パスワードが正しくないと表示される
- 認証サーバーに接続できない

##### 原因と対策
```
原因:
- パスワードの間違い
- 認証サーバーの障害
- ネットワーク設定の問題
- 証明書の問題

対策:
1. パスワードの再確認
   - 大文字・小文字の確認
   - 特殊文字の確認
   - パスワードの再入力

2. 認証サーバーの確認
   - サーバーの状態確認
   - ネットワーク接続の確認
   - ログの確認

3. 設定の再確認
   - 認証方式の確認
   - 証明書の確認
   - ネットワーク設定の確認
```

### 2. 診断ツール

#### 基本的な診断ツール
```bash
# Windows
netsh wlan show profiles
netsh wlan show interfaces
netsh wlan show networks
ipconfig /all
ping アクセスポイントのIP

# Linux
iwconfig
iwlist scan
wpa_supplicant
dhclient
ping アクセスポイントのIP
```

#### 高度な診断ツール
```bash
# パケットキャプチャ
tcpdump -i wlan0
wireshark

# 信号強度の測定
iwconfig wlan0
iwlist wlan0 scan | grep -E "ESSID|Quality|Signal"

# 認証の詳細確認
wpa_supplicant -d -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
```

#### オンラインツール
```
診断ツール:
- Wi-Fi Analyzer（Android）
- WiFi Explorer（macOS）
- inSSIDer（Windows）
- NetSpot（クロスプラットフォーム）

機能:
- 信号強度の測定
- チャンネルの分析
- セキュリティ設定の確認
- ネットワークの最適化
```

### 3. ログ分析

#### アクセスポイントのログ
```bash
# アクセスポイントのログ確認
tail -f /var/log/syslog | grep wlan
tail -f /var/log/auth.log | grep wpa

# 認証ログの確認
tail -f /var/log/radius.log
tail -f /var/log/freeradius/radius.log
```

#### クライアントのログ
```bash
# Windows
eventvwr.msc
# イベントビューアーでWi-Fi関連のイベントを確認

# Linux
journalctl -u NetworkManager
journalctl -u wpa_supplicant
dmesg | grep wlan
```

### 4. パフォーマンス最適化

#### ネットワーク最適化
```
最適化項目:
1. チャンネルの選択
   - 混雑していないチャンネル
   - 5GHz帯の活用
   - チャンネルボンディング

2. 出力電力の調整
   - 適切な出力電力の設定
   - 信号強度の最適化
   - 干渉の最小化

3. アンテナの配置
   - 最適な位置への設置
   - 障害物の回避
   - 指向性アンテナの活用
```

#### セキュリティ最適化
```
最適化項目:
1. 認証の最適化
   - 認証サーバーの冗長化
   - 認証キャッシュの活用
   - 認証タイムアウトの調整

2. 暗号化の最適化
   - 適切な暗号化強度
   - キー更新の最適化
   - ハードウェア暗号化の活用

3. 監視の最適化
   - リアルタイム監視
   - 異常検知の実装
   - ログの最適化
```

---

## まとめ

### WPA2の重要性
WPA2は、無線LANセキュリティにおいて重要な役割を果たしています。適切に設定・運用することで、無線通信のセキュリティを大幅に向上させ、データの保護とプライバシーの確保を実現できます。

### 成功のポイント
1. **適切な設定**: セキュリティ要件に合った設定の選択
2. **強力な認証**: 適切な認証方式の実装
3. **継続的な管理**: 定期的な監視とメンテナンス
4. **セキュリティ強化**: 多層防御によるセキュリティ向上

### 技術の進歩
- **WPA3の普及**: より強力なセキュリティ機能
- **Wi-Fi 6対応**: 新しい無線規格への対応
- **クラウド管理**: クラウドベースの管理システム
- **AI/ML活用**: 機械学習による異常検知

### 学習の継続
WPA2技術は継続的に進歩しています。最新のセキュリティ脅威と対策について常に学習し、実践的なスキルを身につけることが重要です。

---

## 参考資料

### 公式ドキュメント
- [IEEE 802.11i-2004: Amendment 6: Medium Access Control (MAC) Security Enhancements](https://standards.ieee.org/standard/802_11i-2004.html)
- [RFC 3748: Extensible Authentication Protocol (EAP)](https://tools.ietf.org/html/rfc3748)
- [NIST SP 800-97: Establishing Wireless Robust Security Networks](https://csrc.nist.gov/publications/detail/sp/800-97/final)

### 学習リソース
- [Wi-Fi Alliance WPA2 Specification](https://www.wi-fi.org/discover-wi-fi/security)
- [OWASP Wireless Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Wireless_Security_Cheat_Sheet.html)
- [Cisco Wireless Security Best Practices](https://www.cisco.com/c/en/us/support/docs/wireless/4400-series-wireless-lan-controllers/116213-wireless-security-00.html)

### セキュリティ情報
- [KRACK Attack Information](https://www.krackattacks.com/)
- [Wi-Fi Security Vulnerabilities](https://www.wi-fi.org/discover-wi-fi/security)
- [NIST Cybersecurity Framework](https://www.nist.gov/cyberframework)

### ツールとリソース
- [Wireshark](https://www.wireshark.org/)
- [Aircrack-ng](https://www.aircrack-ng.org/)
- [Wi-Fi Analyzer Tools](https://www.metageek.com/products/inssider/)

---

*この文書はWPA2の基本概念を理解するための入門資料です。実際の実装や運用については、具体的な製品のドキュメントや専門的なトレーニングを参照してください。*
