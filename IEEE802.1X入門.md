# IEEE802.1X入門 - ネットワーク認証の基本を理解する

## 目次
1. [IEEE802.1Xとは？](#ieee8021xとは)
2. [IEEE802.1Xの仕組み](#ieee8021xの仕組み)
3. [主要な構成要素](#主要な構成要素)
4. [認証プロセス](#認証プロセス)
5. [EAP（Extensible Authentication Protocol）](#eapextensible-authentication-protocol)
6. [実装方法と設定](#実装方法と設定)
7. [セキュリティの利点](#セキュリティの利点)
8. [トラブルシューティング](#トラブルシューティング)
9. [実践的な例](#実践的な例)
10. [まとめ](#まとめ)

---

## IEEE802.1Xとは？

### 基本定義
**IEEE802.1X**は、有線・無線LANにおいて、ネットワークに接続するデバイスを認証するための標準規格です。ネットワークへの物理的な接続だけでは通信を許可せず、適切な認証を受けたデバイスのみがネットワークにアクセスできるようにします。

### IEEE802.1Xの役割
- **アクセス制御**: 認証されたデバイスのみネットワークアクセスを許可
- **セキュリティ強化**: 不正なデバイスの接続を防止
- **ユーザー認証**: デバイスだけでなくユーザーも認証可能
- **ポリシー適用**: 認証結果に基づいたネットワークポリシーの適用

### なぜIEEE802.1Xが必要なのか

#### 従来のネットワークの問題
```
従来のネットワーク:
デバイス → スイッチ/アクセスポイント → ネットワーク
         ↑
    物理的に接続すれば誰でもアクセス可能
```

#### IEEE802.1Xによる解決
```
IEEE802.1X対応ネットワーク:
デバイス → スイッチ/アクセスポイント → 認証サーバー → ネットワーク
         ↑                    ↑
    認証が必要          認証成功時のみアクセス許可
```

### 主な用途
- **企業ネットワーク**: 社内LANへのアクセス制御
- **教育機関**: 学内ネットワークの管理
- **公共施設**: ゲストネットワークの提供
- **ホテル・カフェ**: 有料・無料Wi-Fiの管理

---

## IEEE802.1Xの仕組み

### 基本的な動作フロー

```
1. デバイス接続
   ↓
2. 認証要求
   ↓
3. 認証サーバーで認証
   ↓
4. 認証成功 → ネットワークアクセス許可
   認証失敗 → アクセス拒否
```

### ポートベースの認証

#### 認証前の状態（Unauthorized）
```
デバイス ←→ [スイッチポート] ←→ 認証サーバー
         ↑
    認証待ち状態
    - 認証トラフィックのみ通過
    - データトラフィックはブロック
```

#### 認証後の状態（Authorized）
```
デバイス ←→ [スイッチポート] ←→ ネットワーク
         ↑
    認証済み状態
    - すべてのトラフィックが通過
    - ネットワークポリシーが適用
```

### 認証のタイミング

| タイミング | 説明 | 例 |
|------------|------|-----|
| **接続時認証** | デバイス接続時に認証 | パソコンをLANケーブル接続 |
| **定期的認証** | 定期的に再認証 | 30分ごとの再認証 |
| **再認証** | 設定変更時の認証 | VLAN変更時 |
| **ログアウト認証** | 切断時の認証 | デバイス取り外し時 |

---

## 主要な構成要素

### 1. サプリカント（Supplicant）
**認証を要求する側のデバイス**

#### 役割
- 認証情報の提供
- 認証プロトコルの実行
- ネットワークアクセスの要求

#### 実装例
```
- Windows: 内蔵の802.1Xクライアント
- macOS: 内蔵の802.1Xクライアント
- Linux: wpa_supplicant
- スマートフォン: 内蔵のWi-Fi設定
- ネットワーク機器: スイッチ、ルーター
```

### 2. オーセンティケーター（Authenticator）
**認証を仲介するネットワーク機器**

#### 役割
- 認証要求の仲介
- 認証結果に基づくアクセス制御
- ネットワークポリシーの適用

#### 実装例
```
- スイッチ: Cisco Catalyst、HP ProCurve
- 無線アクセスポイント: Cisco Aironet、Aruba
- ルーター: 一部のエンタープライズルーター
- 仮想スイッチ: VMware vSwitch、Hyper-V
```

### 3. 認証サーバー（Authentication Server）
**実際に認証を実行するサーバー**

#### 役割
- 認証情報の検証
- 認証結果の通知
- ユーザー・デバイス情報の管理

#### 実装例
```
- RADIUSサーバー: FreeRADIUS、Microsoft NPS
- Active Directory: Windows Server
- LDAPサーバー: OpenLDAP、Active Directory
- クラウドサービス: Azure AD、Google Workspace
```

### 構成図

```
[サプリカント] ←→ [オーセンティケーター] ←→ [認証サーバー]
     ↑                    ↑                    ↑
   デバイス           スイッチ/AP            RADIUS/LDAP
```

---

## 認証プロセス

### 1. 接続開始
```
デバイスがネットワークに接続
↓
スイッチ/APが接続を検知
↓
認証プロセス開始
```

### 2. 認証要求（EAPOL-Start）
```
サプリカント → オーセンティケーター
"認証を開始します"
```

### 3. 認証要求（EAP-Request/Identity）
```
オーセンティケーター → サプリカント
"認証情報を教えてください"
```

### 4. 認証応答（EAP-Response/Identity）
```
サプリカント → オーセンティケーター
"ユーザー名: user@example.com"
```

### 5. 認証サーバーへの転送
```
オーセンティケーター → 認証サーバー
"このユーザーを認証してください"
```

### 6. 認証方法の決定
```
認証サーバー → オーセンティケーター
"EAP-PEAPで認証します"
```

### 7. 認証実行
```
サプリカント ←→ 認証サーバー
（EAP-PEAPによる認証）
```

### 8. 認証結果の通知
```
認証サーバー → オーセンティケーター
"認証成功/失敗"
```

### 9. アクセス制御の適用
```
認証成功: ネットワークアクセス許可
認証失敗: アクセス拒否
```

---

## EAP（Extensible Authentication Protocol）

### EAPとは
**EAP（Extensible Authentication Protocol）**は、IEEE802.1Xで使用される認証プロトコルです。様々な認証方式を統一的に扱うことができます。

### 主要なEAP方式

#### 1. EAP-MD5
```
特徴:
- 最もシンプルな方式
- パスワードベースの認証
- 暗号化なし

用途:
- テスト環境
- 内部ネットワーク
- セキュリティ要件が低い環境
```

#### 2. EAP-TLS
```
特徴:
- 証明書ベースの認証
- 相互認証（クライアント・サーバー両方）
- 高いセキュリティ

用途:
- エンタープライズ環境
- 高セキュリティ要件
- 証明書管理が可能な環境
```

#### 3. EAP-PEAP
```
特徴:
- パスワードベースの認証
- TLSトンネル内で認証
- 広く使用されている

用途:
- 一般的な企業環境
- Active Directory連携
- バランスの取れたセキュリティ
```

#### 4. EAP-TTLS
```
特徴:
- 柔軟な認証方式
- レガシー認証システムとの連携
- 様々な認証方式をサポート

用途:
- 既存システムとの連携
- 複数の認証方式が必要
- 柔軟性が重要な環境
```

### EAP方式の比較

| 方式 | セキュリティ | 実装難易度 | 証明書管理 | 用途 |
|------|-------------|------------|------------|------|
| **EAP-MD5** | 低 | 簡単 | 不要 | テスト環境 |
| **EAP-TLS** | 高 | 難しい | 必要 | エンタープライズ |
| **EAP-PEAP** | 中〜高 | 中程度 | サーバーのみ | 一般的 |
| **EAP-TTLS** | 中〜高 | 中程度 | サーバーのみ | 柔軟性重視 |

---

## 実装方法と設定

### 1. スイッチ/アクセスポイントの設定

#### 基本的な設定手順
```
1. 802.1Xの有効化
2. RADIUSサーバーの設定
3. 認証方式の選択
4. タイムアウト設定
5. フォールバック設定
```

#### Ciscoスイッチの設定例
```cisco
! 802.1Xの有効化
interface GigabitEthernet0/1
 switchport mode access
 authentication port-control auto
 dot1x pae authenticator

! RADIUSサーバーの設定
radius-server host 192.168.1.100 auth-port 1812 acct-port 1813
radius-server key secretkey

! 認証方式の設定
dot1x authentication eap-peap
```

### 2. 認証サーバーの設定

#### FreeRADIUSの設定例
```
# /etc/freeradius/3.0/users
user@example.com Cleartext-Password := "password123"

# /etc/freeradius/3.0/clients.conf
client 192.168.1.10 {
    secret = secretkey
    shortname = switch1
}
```

### 3. クライアントの設定

#### Windows 10の設定
```
1. ネットワーク設定を開く
2. Wi-Fi設定を選択
3. ネットワークを選択
4. セキュリティ設定で「WPA2-Enterprise」を選択
5. 認証方式を「PEAP」に設定
6. ユーザー名とパスワードを入力
```

#### Linux（wpa_supplicant）の設定
```bash
# /etc/wpa_supplicant/wpa_supplicant.conf
network={
    ssid="CompanyWiFi"
    key_mgmt=WPA-EAP
    eap=PEAP
    identity="user@example.com"
    password="password123"
    phase2="auth=MSCHAPV2"
}
```

---

## セキュリティの利点

### 1. アクセス制御の強化

#### 従来の方法との比較
```
従来の方法:
- MACアドレスフィルタリング
- パスワード保護（WPA2-PSK）
- 物理的なアクセス制御

IEEE802.1X:
- ユーザー認証
- デバイス認証
- 動的なポリシー適用
- 中央集権的な管理
```

### 2. セキュリティ機能

#### 認証機能
- **ユーザー認証**: ユーザーIDとパスワード
- **デバイス認証**: 証明書ベースの認証
- **多要素認証**: 追加の認証要素
- **相互認証**: クライアント・サーバー両方の認証

#### アクセス制御機能
- **VLAN割り当て**: 認証結果に基づくVLAN分離
- **ACL適用**: アクセス制御リストの動的適用
- **帯域制御**: ユーザーごとの帯域制限
- **時間制限**: 時間帯によるアクセス制御

### 3. 監視・ログ機能

#### ログの種類
```
- 認証ログ: 認証成功/失敗の記録
- アクセスログ: ネットワークアクセスの記録
- セキュリティログ: 不正アクセスの検出
- 監査ログ: 設定変更の記録
```

#### 監視のポイント
```
1. 認証失敗の多発
2. 異常な時間帯のアクセス
3. 未知のデバイスからの接続
4. 認証方式の変更
5. 大量の接続試行
```

---

## トラブルシューティング

### 1. 一般的な問題と解決方法

#### 認証が失敗する

##### 症状
- デバイスがネットワークに接続できない
- 認証エラーメッセージが表示される
- 接続はできるがインターネットにアクセスできない

##### 診断手順
```
1. 認証サーバーの状態確認
   - サービスが起動しているか
   - 設定ファイルが正しいか
   - ログにエラーがないか

2. ネットワーク接続の確認
   - スイッチ/APとサーバーの通信
   - ファイアウォールの設定
   - ルーティングの確認

3. クライアント設定の確認
   - 認証方式の設定
   - ユーザー情報の入力
   - 証明書の有効性
```

##### 解決方法
```
1. 設定の見直し
   - 認証サーバーの設定確認
   - クライアント設定の修正
   - ネットワーク設定の確認

2. ログの分析
   - 認証サーバーのログ確認
   - スイッチ/APのログ確認
   - クライアントのログ確認

3. 段階的なテスト
   - 単一デバイスでのテスト
   - 異なる認証方式でのテスト
   - ネットワーク分離でのテスト
```

#### 接続が不安定

##### 症状
- 定期的に接続が切れる
- 認証は成功するが通信が不安定
- 再認証が頻繁に発生する

##### 原因と対策
```
1. タイムアウト設定の問題
   - 再認証間隔の調整
   - セッションタイムアウトの設定
   - アイドルタイムアウトの調整

2. ネットワークの問題
   - 帯域不足
   - パケットロス
   - 遅延の増加

3. サーバーの問題
   - リソース不足
   - 設定の不整合
   - ソフトウェアのバグ
```

### 2. ログ分析の方法

#### 重要なログ項目
```
1. タイムスタンプ
2. 送信元IPアドレス
3. ユーザー名
4. 認証方式
5. 認証結果
6. エラーメッセージ
7. セッション情報
8. ポリシー適用結果
```

#### ログ分析ツール
```
1. 標準ツール
   - grep, awk, sed（Linux/Unix）
   - PowerShell（Windows）
   - テキストエディタ

2. 専用ツール
   - Splunk
   - ELK Stack
   - Graylog
   - 各ベンダーの管理ツール
```

---

## 実践的な例

### 例1: 小規模オフィスの導入

#### 環境
- 従業員数: 20名
- デバイス: ノートPC、スマートフォン
- ネットワーク: 有線LAN + Wi-Fi

#### 設定例
```
1. スイッチ設定
   - 全ポートで802.1X有効化
   - RADIUSサーバー設定
   - ゲストVLAN設定

2. 認証サーバー設定
   - FreeRADIUS導入
   - ユーザー情報の登録
   - 認証方式: EAP-PEAP

3. クライアント設定
   - Windows: 内蔵クライアント使用
   - スマートフォン: Wi-Fi設定で認証情報入力
```

### 例2: 大規模企業の導入

#### 環境
- 従業員数: 1000名以上
- デバイス: 多様なデバイス
- ネットワーク: 複数拠点、クラウド連携

#### 設定例
```
1. 中央集権的管理
   - Active Directory連携
   - 証明書ベース認証（EAP-TLS）
   - ポリシー管理システム

2. 多層防御
   - ネットワーク分離
   - 動的VLAN割り当て
   - セキュリティポリシー適用

3. 監視・管理
   - SIEM連携
   - リアルタイム監視
   - 自動化された対応
```

### 例3: 教育機関の導入

#### 環境
- 学生・教職員: 5000名
- デバイス: 個人デバイス、学内PC
- ネットワーク: 学内LAN + ゲストWi-Fi

#### 設定例
```
1. ユーザー分類
   - 学生: 制限付きアクセス
   - 教職員: フルアクセス
   - ゲスト: インターネットのみ

2. 認証方式
   - 学生: EAP-PEAP（学籍番号）
   - 教職員: EAP-TLS（証明書）
   - ゲスト: ポータル認証

3. ポリシー適用
   - 帯域制限
   - アクセス時間制限
   - コンテンツフィルタリング
```

---

## まとめ

### IEEE802.1Xの重要なポイント

1. **セキュリティ強化**: 認証によるアクセス制御
2. **柔軟性**: 様々な認証方式のサポート
3. **スケーラビリティ**: 小規模から大規模まで対応
4. **標準化**: 業界標準による互換性
5. **管理性**: 中央集権的な管理が可能

### 導入のメリット

| 項目 | 従来の方法 | IEEE802.1X |
|------|------------|------------|
| **セキュリティ** | パスワードのみ | 多要素認証 |
| **管理** | 個別設定 | 中央集権管理 |
| **柔軟性** | 固定設定 | 動的ポリシー |
| **監視** | 限定的 | 包括的 |
| **コスト** | 低 | 中〜高 |

### 導入時の注意点

1. **段階的な導入**: テスト環境での検証
2. **ユーザー教育**: 認証方法の説明
3. **フォールバック**: 認証失敗時の対応
4. **監視体制**: 24時間監視の検討
5. **バックアップ**: 設定とデータのバックアップ

### 今後の展望

- **クラウド連携**: クラウドベースの認証サービス
- **IoT対応**: IoTデバイス向けの軽量認証
- **AI活用**: 異常検知と自動対応
- **ゼロトラスト**: ゼロトラストセキュリティとの統合

### 学習の継続

IEEE802.1Xは継続的に進歩している技術です。最新の認証方式やセキュリティ要件について常に学習し、実践的なスキルを身につけることが重要です。

---

## 参考資料

### 公式ドキュメント
- [IEEE 802.1X-2020: Port-Based Network Access Control](https://standards.ieee.org/standard/802_1X-2020.html)
- [RFC 3748: Extensible Authentication Protocol (EAP)](https://tools.ietf.org/html/rfc3748)
- [RFC 2865: Remote Authentication Dial In User Service (RADIUS)](https://tools.ietf.org/html/rfc2865)

### 学習リソース
- [Cisco 802.1X Configuration Guide](https://www.cisco.com/c/en/us/support/docs/security/identity-management-engine/116291-configure-802-1x-guide.html)
- [FreeRADIUS Documentation](https://freeradius.org/documentation/)
- [Microsoft NPS Documentation](https://docs.microsoft.com/en-us/windows-server/networking/technologies/nps/nps-top)

### セキュリティ情報
- [NIST SP 800-46: Guide to Enterprise Telework and Remote Access Security](https://csrc.nist.gov/publications/detail/sp/800-46/rev-2/final)
- [CIS Controls: Account Management](https://www.cisecurity.org/controls/)
- [SANS 802.1X Security](https://www.sans.org/white-papers/382/)

---

*この文書はIEEE802.1Xの基本概念を理解するための入門資料です。実際の実装や運用については、具体的な製品のドキュメントや専門的なトレーニングを参照してください。*
